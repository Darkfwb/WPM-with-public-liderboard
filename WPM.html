<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WPM Tester - Yellow Edition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --yellow-bg: #fff700;
            --yellow-dark: #ffd600;
            --yellow-accent: #ffee58;
            --text-color: #212121;
            --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        body {
            background: linear-gradient(120deg, var(--yellow-bg), var(--yellow-dark));
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: var(--yellow-accent);
            border-radius: 16px;
            box-shadow: var(--box-shadow);
            padding: 2.5rem 2rem;
            max-width: 550px;
            width: 96%;
            margin: 2rem auto;
            text-align: center;
        }
        h1 {
            margin-bottom: 0.2em;
            font-size: 2.3rem;
            letter-spacing: 2px;
            color: #b89c00;
        }
        #quote {
            font-size: 1.18rem;
            margin: 1.5rem 0;
            padding: 1.1em;
            background: #fffde7;
            border-radius: 9px;
            min-height: 60px;
            word-break: break-word;
            user-select: none;
            box-shadow: 0 2px 6px rgba(200, 180, 0, 0.08);
        }
        #input {
            width: 100%;
            font-size: 1.1rem;
            padding: 0.7em;
            border: 2px solid #ffd600;
            border-radius: 7px;
            outline: none;
            background: #fffde7;
            color: #212121;
            margin-bottom: 1.1rem;
            transition: border-color 0.2s;
        }
        #input:focus {
            border-color: #b89c00;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1.3em;
        }
        .stat {
            background: #fffde7;
            border-radius: 7px;
            padding: 0.7em 1.2em;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.08);
            font-weight: bold;
            color: #b89c00;
        }
        #restart {
            background: #fff700;
            border: none;
            border-radius: 6px;
            padding: 0.7em 2em;
            font-size: 1rem;
            font-weight: bold;
            color: #212121;
            box-shadow: 0 2px 6px rgba(0,0,0,0.09);
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        #restart:hover {
            background: #b89c00;
            color: #fffde7;
        }
        #translate {
            background: #b89c00;
            color: #fffde7;
            border: none;
            border-radius: 6px;
            padding: 0.5em 1.5em;
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 1.5em;
            margin-top: -0.5em;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        #translate:hover {
            background: #fff700;
            color: #212121;
        }
        .bomb-game {
            margin-top: 2em;
            background: #fffde7;
            border-radius: 11px;
            padding: 1em 1em 1.3em 1em;
            box-shadow: 0 2px 18px rgba(255, 215, 0, 0.15);
            color: #b89c00;
            text-align: center;
            font-size: 1.08rem;
            position: relative;
        }
        .bomb-title {
            font-weight: bold;
            font-size: 1.08em;
            letter-spacing: 1.2px;
            margin-bottom: 0.6em;
        }
        .bomb-emoji {
            font-size: 2.2em;
            margin: 0.2em 0;
            display: block;
        }
        .bomb-timer {
            font-size: 1.4em;
            font-weight: bold;
            color: #c62828;
            margin: 0.3em 0 0.7em 0;
        }
        .bomb-status {
            font-size: 1.1em;
            font-weight: bold;
            color: #c62828;
            margin-top: 0.6em;
            min-height: 1.2em;
        }
        #bombInput {
            width: 100%;
            font-size: 1.08rem;
            padding: 0.6em;
            border: 2px solid #ffd600;
            border-radius: 7px;
            outline: none;
            background: #fffde7;
            color: #212121;
            margin-bottom: 0.6em;
            margin-top: 0.6em;
            transition: border-color 0.2s;
            text-align: left;
        }
        #bombInput:focus {
            border-color: #b89c00;
        }
        #startBomb {
            background: #fff700;
            border: none;
            border-radius: 6px;
            padding: 0.6em 2.2em;
            font-size: 1rem;
            font-weight: bold;
            color: #212121;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            cursor: pointer;
            margin-top: 0.7em;
            transition: background 0.2s, color 0.2s;
        }
        #startBomb:hover {
            background: #b89c00;
            color: #fffde7;
        }
        .bomb-leaderboard {
            margin: 1.5em auto 0 auto;
            background: #fffde7;
            border-radius: 9px;
            padding: 1.1em 0.7em 0.9em 0.7em;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.08);
            color: #b89c00;
            text-align: center;
            width: 99%;
            max-width: 350px;
        }
        .bomb-leaderboard-title {
            font-weight: bold;
            font-size: 1.05em;
            letter-spacing: 1px;
            margin-bottom: 0.5em;
        }
        .bomb-leaderboard-list {
            list-style: none;
            margin: 0.2em 0 0 0;
            padding: 0;
        }
        .bomb-leaderboard-list li {
            background: #fffde7;
            border-radius: 5px;
            margin: 0.12em 0;
            padding: 0.37em 0.5em;
            font-size: 1em;
            color: #b89c00;
            text-align: left;
            display: flex;
            justify-content: space-between;
        }
        .bomb-leaderboard-list li .score {
            color: #388e3c;
            font-weight: bold;
        }
        .bomb-leaderboard-list li .date {
            color: #7e6900;
            font-size: 0.92em;
            margin-left: 1.3em;
        }
        @media (max-width: 600px) {
            .container {
                padding: 1.2rem 0.4rem;
            }
            #quote {
                font-size: 1rem;
            }
            .bomb-game, .bomb-leaderboard {
                padding: 0.7em 0.2em 0.7em 0.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° WPM Yellow Tester ‚ö°</h1>
        <button id="translate" type="button">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π</button>
        <div id="quote">Loading...</div>
        <input type="text" id="input" autocomplete="off" placeholder="Start typing here..." disabled />
        <div class="stats">
            <div class="stat">WPM: <span id="wpm">0</span></div>
            <div class="stat">Time: <span id="time">0.0</span>s</div>
        </div>
        <button id="restart">Restart</button>
        <div class="bomb-game" id="bombGame">
            <div class="bomb-title" id="bombTitle">üí£ Bomb Mini Game (15s typing challenge!)</div>
            <span class="bomb-emoji" id="bombEmoji">üí£</span>
            <div class="bomb-timer" id="bombTimer">15.0</div>
            <div id="bombDesc" style="font-size:0.98em;margin-bottom:0.8em;color:#7e6900;">Type the phrase before the bomb blows up!</div>
            <div id="bombQuote" style="background:#fffde7;border-radius:6px;padding:0.5em 0.7em;margin-bottom:0.4em;min-height:40px;"></div>
            <input type="text" id="bombInput" autocomplete="off" placeholder="Type here to defuse the bomb!" disabled />
            <br>
            <button id="startBomb">Start Bomb Game</button>
            <div class="bomb-status" id="bombStatus"></div>
            <audio id="bombSound">
                <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b9c8b43.mp3" type="audio/mp3">
            </audio>
            <div class="bomb-leaderboard" id="bombLeaderboard">
                <div class="bomb-leaderboard-title" id="bombLeaderboardTitle">üèÖ Bomb Game Leaderboard</div>
                <ul class="bomb-leaderboard-list" id="bombLeaderboardList"></ul>
                <div id="bombLeaderboardNote" style="font-size:0.93em;color:#7e6900;margin-top:0.4em;">(Top 5 fastest defuses, lower is better!)</div>
            </div>
        </div>
    </div>
    <script>
        // English and Russian text for translation
        const translation = {
            en: {
                quotePlaceholder: "Start typing here...",
                restart: "Restart",
                bombTitle: "üí£ Bomb Mini Game (15s typing challenge!)",
                bombDesc: "Type the phrase before the bomb blows up!",
                bombPlaceholder: "Type here to defuse the bomb!",
                startBomb: "Start Bomb Game",
                bombLeaderboardTitle: "üèÖ Bomb Game Leaderboard",
                bombLeaderboardNote: "(Top 5 fastest defuses, lower is better!)",
                bombDefused: time => `üéâ Bomb defused in ${time.toFixed(2)}s!`,
                bombExploded: "üí• BOOM! The bomb exploded!",
                bombNoDefuses: "No defuses yet!",
                translate: "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π"
            },
            ru: {
                quotePlaceholder: "–ù–∞—á–Ω–∏—Ç–µ –ø–µ—á–∞—Ç–∞—Ç—å –∑–¥–µ—Å—å...",
                restart: "–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å",
                bombTitle: "üí£ –ú–∏–Ω–∏-–∏–≥—Ä–∞: –ë–æ–º–±–∞ (15 —Å–µ–∫. –Ω–∞ –Ω–∞–±–æ—Ä!)",
                bombDesc: "–ù–∞–±–µ—Ä–∏—Ç–µ —Ñ—Ä–∞–∑—É –¥–æ –≤–∑—Ä—ã–≤–∞ –±–æ–º–±—ã!",
                bombPlaceholder: "–ü–µ—á–∞—Ç–∞–π—Ç–µ –∑–¥–µ—Å—å –¥–ª—è –æ–±–µ–∑–≤—Ä–µ–∂–∏–≤–∞–Ω–∏—è!",
                startBomb: "–°—Ç–∞—Ä—Ç –º–∏–Ω–∏-–∏–≥—Ä—ã",
                bombLeaderboardTitle: "üèÖ –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ (–ë–æ–º–±–∞)",
                bombLeaderboardNote: "(–¢–æ–ø-5 —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö –æ–±–µ–∑–≤—Ä–µ–∂–∏–≤–∞–Ω–∏–π, –º–µ–Ω—å—à–µ ‚Äî –ª—É—á—à–µ!)",
                bombDefused: time => `üéâ –û–±–µ–∑–≤—Ä–µ–∂–µ–Ω–æ –∑–∞ ${time.toFixed(2)}—Å!`,
                bombExploded: "üí• –ë–£–ú! –ë–æ–º–±–∞ –≤–∑–æ—Ä–≤–∞–ª–∞—Å—å!",
                bombNoDefuses: "–ü–æ–±–µ–¥ –ø–æ–∫–∞ –Ω–µ—Ç!",
                translate: "Translate to English"
            }
        };

        // Sample quotes (en/ru pairs)
        const quotesEn = [
            "The quick brown fox jumps over the lazy dog.",
            "Typing fast is a useful skill for everyone.",
            "Yellow is the color of sunshine and energy.",
            "Practice makes perfect when it comes to typing.",
            "Code, type, repeat. Improve your WPM daily!",
            "Speed and accuracy go hand in hand.",
            "Let your fingers dance across the keys.",
            "Stay focused and keep your eyes on the screen.",
            "A bright mind deserves a bright interface.",
            "Consistency is the key to mastering typing."
        ];
        const quotesRu = [
            "–ù–µ –ø–ª—é–π –≤ –∫–æ–ª–æ–¥–µ—Ü, –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –≤–æ–¥—ã –Ω–∞–ø–∏—Ç—å—Å—è",
            " –ü–æ–¥ –ª–µ–∂–∞—á–∏–π –∫–∞–º–µ–Ω—å –∏ –≤–æ–¥–∞ –Ω–µ —Ç–µ—á–µ—Ç ",
            "–ë–µ–∑ —Ç—Ä—É–¥–∞ –Ω–µ –≤—ã–ª–æ–≤–∏—à—å –∏ —Ä—ã–±–∫—É –∏–∑ –ø—Ä—É–¥–∞.",
            "–ë—ã–ª –±—ã –ª–µ—Å, —Å–æ–ª–æ–≤—å–∏ –ø—Ä–∏–ª–µ—Ç—è—Ç.",
            "–ù–µ –±–µ—Ä–µ—á—å –ø–æ—Ä–æ—Å–ª–∏, –Ω–µ –≤–∏–¥–∞—Ç—å –∏ –¥–µ—Ä–µ–≤–∞.",
            "–ö—Ç–æ –Ω–µ —Å–∞–∂–∞–ª –¥–µ—Ä–µ–≤–∞, —Ç–æ–º—É –Ω–µ –ª–µ–∂–∞—Ç—å –≤ —Ç–µ–Ω–∏.",
            "–õ–∞—Å—Ç–æ—á–∫–∞ –≤–µ—Å–Ω—É –Ω–∞—á–∏–Ω–∞–µ—Ç, —Å–æ–ª–æ–≤–µ–π –∫–æ–Ω—á–∞–µ—Ç.",
            "–î–≤–∞–∂–¥—ã –≤ –≥–æ–¥ –ª–µ—Ç–æ –Ω–µ –±—ã–≤–∞–µ—Ç.",
            "–ù–µ –∑–∏–º–∞ –∑–Ω–æ–±–∏—Ç, –∞ –≤–µ—Å–Ω–∞.",
            "–õ–µ—Ç–æ–º - –ø—ã–ª—å, –∑–∏–º–æ—é —Å–Ω–µ–≥ –æ–¥–æ–ª–µ–≤–∞–µ—Ç."
        ];

        let siteLang = "en"; // 'en' or 'ru'
        let isBombRu = false; // true if bomb game is currently using Russian

        // Elements
        const quoteEl = document.getElementById('quote');
        const inputEl = document.getElementById('input');
        const wpmEl = document.getElementById('wpm');
        const timeEl = document.getElementById('time');
        const restartBtn = document.getElementById('restart');
        const translateBtn = document.getElementById('translate');

        // Bomb Elements
        const bombEmoji = document.getElementById('bombEmoji');
        const bombTimerEl = document.getElementById('bombTimer');
        const bombQuoteEl = document.getElementById('bombQuote');
        const bombInputEl = document.getElementById('bombInput');
        const startBombBtn = document.getElementById('startBomb');
        const bombStatusEl = document.getElementById('bombStatus');
        const bombSound = document.getElementById('bombSound');
        const bombTitleEl = document.getElementById('bombTitle');
        const bombDescEl = document.getElementById('bombDesc');
        const bombLeaderboardTitle = document.getElementById('bombLeaderboardTitle');
        const bombLeaderboardNote = document.getElementById('bombLeaderboardNote');
        const bombLeaderboardList = document.getElementById('bombLeaderboardList');

        // --- Main WPM game logic ---
        let currentQuote = '';
        let currentQuoteRu = '';
        let startTime = null;
        let interval = null;
        let finished = false;

        function pickQuote(lang = 'en') {
            let idx = Math.floor(Math.random() * quotesEn.length);
            return lang === 'ru' ? quotesRu[idx] : quotesEn[idx];
        }

        function pickQuoteSync() {
            // Returns [en, ru] pair
            let idx = Math.floor(Math.random() * quotesEn.length);
            return [quotesEn[idx], quotesRu[idx]];
        }

        function reset() {
            inputEl.value = '';
            inputEl.disabled = true;
            wpmEl.textContent = '0';
            timeEl.textContent = '0.0';
            finished = false;
            [currentQuote, currentQuoteRu] = pickQuoteSync();
            quoteEl.textContent = siteLang === 'ru' ? currentQuoteRu : currentQuote;
            clearInterval(interval);
            setTimeout(() => {
                inputEl.disabled = false;
                inputEl.placeholder = translation[siteLang].quotePlaceholder;
                inputEl.focus();
                startTime = null;
            }, 300);
        }

        inputEl.addEventListener('input', () => {
            if (!startTime) {
                startTime = Date.now();
                interval = setInterval(updateStats, 80);
            }
            const typed = inputEl.value;
            const target = siteLang === 'ru' ? currentQuoteRu : currentQuote;
            // No highlight for simplicity, just check
            if (typed === target) {
                finished = true;
                clearInterval(interval);
                updateStats(true);
                inputEl.disabled = true;
            }
        });

        function updateStats(forceEnd = false) {
            if (!startTime) return;
            let elapsed = (Date.now() - startTime) / 1000;
            if (forceEnd) elapsed = (Date.now() - startTime) / 1000;
            timeEl.textContent = elapsed.toFixed(1);

            const words = (siteLang === 'ru' ? currentQuoteRu : currentQuote).trim().split(/\s+/).length;
            let wpm = (inputEl.value.length === 0) ? 0 : (words / (elapsed / 60));
            wpmEl.textContent = Math.round(wpm);

            if (finished) {
                timeEl.textContent = elapsed.toFixed(1);
                wpmEl.textContent = Math.round(wpm);
            }
        }

        restartBtn.addEventListener('click', reset);

        // --- Bomb Mini Game logic ---
        let bombGameActive = false;
        let bombTimer = 15.0;
        let bombInterval = null;
        let bombStartTime = null;
        let bombQuote = '';
        let bombQuoteRu = '';
        let bombFinished = false;

        function resetBombGameUI() {
            bombEmoji.textContent = "üí£";
            bombTimerEl.textContent = "15.0";
            bombStatusEl.textContent = "";
            bombInputEl.value = "";
            bombInputEl.disabled = true;
            bombQuoteEl.style.background = "#fffde7";
            bombQuoteEl.style.color = "#212121";
            startBombBtn.disabled = false;
            bombFinished = false;
        }

        function startBombGame() {
            resetBombGameUI();
            let idx = Math.floor(Math.random() * quotesEn.length);
            bombQuote = quotesEn[idx];
            bombQuoteRu = quotesRu[idx];
            bombQuoteEl.textContent = isBombRu ? bombQuoteRu : bombQuote;
            bombInputEl.disabled = false;
            bombInputEl.placeholder = isBombRu ? translation.ru.bombPlaceholder : translation.en.bombPlaceholder;
            bombInputEl.focus();
            startBombBtn.disabled = true;
            bombGameActive = true;
            bombTimer = 15.0;
            bombStartTime = Date.now();
            bombTimerEl.textContent = bombTimer.toFixed(1);
            bombStatusEl.textContent = "";
            bombQuoteEl.style.background = "#fffde7";
            bombQuoteEl.style.color = "#212121";
            bombEmoji.textContent = "üí£";
            bombInterval = setInterval(bombTick, 50);
        }

        function bombTick() {
            if (!bombGameActive) return;
            let elapsed = (Date.now() - bombStartTime) / 1000;
            let remaining = Math.max(0, 15.0 - elapsed);
            bombTimerEl.textContent = remaining.toFixed(1);
            if (remaining <= 0) {
                bombExplode();
            }
        }

        function bombExplode() {
            if (bombFinished) return;
            bombFinished = true;
            bombGameActive = false;
            clearInterval(bombInterval);
            bombInputEl.disabled = true;
            bombStatusEl.textContent = isBombRu ? translation.ru.bombExploded : translation.en.bombExploded;
            bombQuoteEl.style.background = "#ffe0e0";
            bombQuoteEl.style.color = "#c62828";
            bombEmoji.textContent = "üí•";
            try { bombSound.currentTime = 0; bombSound.play(); } catch {}
            startBombBtn.disabled = false;
        }

        function bombDefused() {
            if (bombFinished) return;
            bombFinished = true;
            bombGameActive = false;
            clearInterval(bombInterval);
            bombInputEl.disabled = true;
            // Score = time taken to defuse (lower is better)
            let timeTaken = (Date.now() - bombStartTime) / 1000;
            bombStatusEl.textContent = (isBombRu ? translation.ru.bombDefused : translation.en.bombDefused)(timeTaken);
            bombQuoteEl.style.background = "#eaffd8";
            bombQuoteEl.style.color = "#388e3c";
            bombEmoji.textContent = "üü©";
            saveBombScore(timeTaken, isBombRu ? bombQuoteRu : bombQuote);
            showBombLeaderboard();
            startBombBtn.disabled = false;
        }

        bombInputEl.addEventListener('input', () => {
            if (!bombGameActive) return;
            if (bombInputEl.value === (isBombRu ? bombQuoteRu : bombQuote)) {
                bombDefused();
            }
        });

        startBombBtn.addEventListener('click', startBombGame);

        // Bomb Leaderboard Logic
        function bombLeaderboardKey() {
            // Separate for each language
            return isBombRu ? 'bomb-leaderboard-ru' : 'bomb-leaderboard-en';
        }

        function getBombLeaderboard() {
            let board = localStorage.getItem(bombLeaderboardKey());
            if (board) {
                try {
                    let arr = JSON.parse(board);
                    if (!Array.isArray(arr)) return [];
                    return arr;
                } catch {
                    return [];
                }
            }
            return [];
        }

        function saveBombScore(time, quote) {
            let scores = getBombLeaderboard();
            const now = new Date();
            const pad = n => n.toString().padStart(2, '0');
            const dateStr = now.getFullYear()+"-"+pad(now.getMonth()+1)+"-"+pad(now.getDate())+" "+pad(now.getHours())+":"+pad(now.getMinutes());
            scores.push({
                time: parseFloat(time),
                date: dateStr,
                quote: quote
            });
            // Sort by time ascending, keep only 5 best
            scores.sort((a, b) => a.time - b.time);
            scores = scores.slice(0, 5);
            localStorage.setItem(bombLeaderboardKey(), JSON.stringify(scores));
        }

        function showBombLeaderboard() {
            let scores = getBombLeaderboard();
            bombLeaderboardList.innerHTML = "";
            let noDefuses = isBombRu ? translation.ru.bombNoDefuses : translation.en.bombNoDefuses;
            if (!scores.length) {
                bombLeaderboardList.innerHTML = "<li>" + noDefuses + "</li>";
                return;
            }
            scores.forEach((score, idx) => {
                const li = document.createElement('li');
                li.innerHTML = `<span>#${idx+1}</span> <span class="score">${score.time.toFixed(2)}s</span> <span class="date">${score.date}</span>`;
                li.title = (isBombRu ? "–§—Ä–∞–∑–∞: " : "Phrase: ") + score.quote;
                bombLeaderboardList.appendChild(li);
            });
        }

        // Language Switch
        translateBtn.addEventListener('click', () => {
            // Toggle language for writing part and bomb game ONLY
            siteLang = siteLang === 'en' ? 'ru' : 'en';
            isBombRu = siteLang === 'ru';
            // Writing part (quote, input, restart)
            quoteEl.textContent = siteLang === 'ru' ? currentQuoteRu : currentQuote;
            inputEl.placeholder = translation[siteLang].quotePlaceholder;
            restartBtn.textContent = translation[siteLang].restart;
            // Bomb game
            bombTitleEl.textContent = translation[siteLang].bombTitle;
            bombDescEl.textContent = translation[siteLang].bombDesc;
            bombInputEl.placeholder = translation[siteLang].bombPlaceholder;
            startBombBtn.textContent = translation[siteLang].startBomb;
            bombLeaderboardTitle.textContent = translation[siteLang].bombLeaderboardTitle;
            bombLeaderboardNote.textContent = translation[siteLang].bombLeaderboardNote;
            // Bomb quote
            bombQuoteEl.textContent = isBombRu ? bombQuoteRu : bombQuote;
            // Leaderboard
            showBombLeaderboard();
            // Translate button label
            translateBtn.textContent = translation[siteLang].translate;
        });

        // Initialize
        resetBombGameUI();
        showBombLeaderboard();
        reset();
    </script>
</body>
</html>
